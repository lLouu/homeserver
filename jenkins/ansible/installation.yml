---
- name: Zero Trust Self
  hosts: all
  tasks:
  - name: Delete undeleted script
    file:
      path: /tmp/0trust.sh
      state: absent
  - name: Download 0trust script
    get_url:
      url: https://raw.githubusercontent.com{{ repository }}/{{ branch }}/sub_scripts/0trust.sh
      dest: /tmp/0trust.sh
      mode: '0755'
  - name: Run 0trust script
    shell: /tmp/0trust.sh {{ repository }} {{ branch }} {{ inventory_hostname }}
    failed_when: false
    register: script_output
  - name: Delete script
    file:
      path: /tmp/0trust.sh
      state: absent

- name: Install Software
  hosts: all
  tasks:
  - name: Delete undeleted script
    file:
      path: /tmp/{{ inventory_hostname }}.install.sh
      state: absent
  - name: Download install script
    get_url:
      url: https://raw.githubusercontent.com{{ repository }}/{{ branch }}/sub_scripts/installations/{{ inventory_hostname }}.install.sh
      dest: /tmp/{{ inventory_hostname }}.install.sh
      mode: '0755'
  - name: Run install script
    shell: /tmp/{{ inventory_hostname }}.install.sh
    failed_when: false
    register: script_output
  - name: Delete script
    file:
      path: /tmp/{{ inventory_hostname }}.install.sh
      state: absent

- name: Config Software
  hosts: all
  tasks:
  - name: Delete undeleted script
    file:
      path: /tmp/{{ inventory_hostname }}.config.sh
      state: absent
  - name: Download config script
    get_url:
      url: https://raw.githubusercontent.com{{ repository }}/{{ branch }}/sub_scripts/configurations/{{ inventory_hostname }}.config.sh
      dest: /tmp/{{ inventory_hostname }}.config.sh
      mode: 0755
  - name: Run config script
    shell: /tmp/{{ inventory_hostname }}.config.sh
    failed_when: false
    register: script_output
  - name: Delete script
    file:
      path: /tmp/{{ inventory_hostname }}.config.sh
      state: absent
